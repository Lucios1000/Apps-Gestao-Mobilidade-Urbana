name: Release Cleanup on Tag Delete

on:
  delete:
    types: [tag]

permissions:
  contents: write

jobs:
  cleanup:
    if: github.event.ref_type == 'tag'
    runs-on: ubuntu-latest
    steps:
      - name: Delete release for deleted tag
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const tag = context.payload.ref; // tag name
            try {
              const rel = await github.rest.repos.getReleaseByTag({ owner, repo, tag });
              await github.rest.repos.deleteRelease({ owner, repo, release_id: rel.data.id });
              core.info(`Deleted release for tag ${tag}`);
            } catch (e) {
              core.warning(`No release found for tag ${tag} or failed to delete: ${e.message}`);
            }